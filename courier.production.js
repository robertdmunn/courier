/*
 *  courier v0.2.2
 *  
 *  Copyright (c) 2014 Robert Munn; Licensed MIT
 */
/*
 *  ES6 Promises shim from when.js, Copyright (c) 2010-2014 Brian Cavalier, John Hann, MIT License
 */
!function(a){function b(a){function b(a){function b(){for(var b,d=[],e=0;e<arguments.length;e++)"string"==typeof arguments[e]?d.push(m(arguments[e])):b=arguments[e];"function"!=typeof b&&(b=function(a){return function(){return a}}(b)),c={deps:d,execute:function(c){for(var e=[],f=0;f<d.length;f++)e.push(c(d[f]));var g=b.apply(a.global,e);return"undefined"!=typeof g?g:void 0}}}c=null,a.global.module=void 0,a.global.exports=void 0,a.global.courier=b}var c,d=/(?:^\s*|[}{\(\);,\n\?\&]\s*)courier\s*\(\s*((?:"[^"]+"\s*,|'[^']+'\s*,\s*)*)/,e=a.instantiate;return a.instantiate=function(a){var f=this;if("courier"===a.metadata.format||!a.metadata.format&&a.source.match(d)){a.metadata.format="courier";var g=f.global.courier;if(b(f),f.__exec(a),f.global.courier=g,!c)throw"Courier module "+a.name+" did not call courier";c&&(a.metadata.deps=a.metadata.deps?a.metadata.deps.concat(c.deps):c.deps,a.metadata.execute=c.execute)}return e.call(f,a)},a}var c=function(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})},d=function(a,b){var c,d;if("number"==typeof a.length&&a.length-1 in a)for(c=0,d=a.length;d>c;c++)b.call(a[c],a[c],c,a);else for(c in a)a.hasOwnProperty(c)&&b.call(a[c],a[c],c,a);return a},e=function(a){return"string"==typeof a},f=function(a,b){return d(b,function(b,c){a[c]=b}),a},g=function(a){var b=a.lastIndexOf("/");return-1!==b?a.substr(0,b):a},h=function(a){return a[a.length-1]},i=function(a){var b=String(a).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return b?{href:b[0]||"",protocol:b[1]||"",authority:b[2]||"",host:b[3]||"",hostname:b[4]||"",port:b[5]||"",pathname:b[6]||"",search:b[7]||"",hash:b[8]||""}:null},j=function(a,b){function c(a){var b=[];return a.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(a){"/.."===a?b.pop():b.push(a)}),b.join("").replace(/^\//,"/"===a.charAt(0)?"/":"")}return b=i(b||""),a=i(a||""),b&&a?(b.protocol||a.protocol)+(b.protocol||b.authority?b.authority:a.authority)+c(b.protocol||b.authority||"/"===b.pathname.charAt(0)?b.pathname:b.pathname?(a.authority&&!a.pathname?"/":"")+a.pathname.slice(0,a.pathname.lastIndexOf("/")+1)+b.pathname:a.pathname)+(b.protocol||b.authority||b.pathname?b.search:b.search||a.search)+b.hash:null},k=function(a){var b=a.lastIndexOf("/"),c=(-1==b?a:a.substr(b+1)).match(/^[\w-\s\.]+/);return c?c[0]:""},l=function(a){var b=k(a),c=b.lastIndexOf(".");return-1!==c?b.substr(c+1):""},m=function(a){var b=a.lastIndexOf("!"),c="";if(-1!=b){var d=a.substr(0,b),e=a.substr(b+1);c="!"+e,a=d}var f=k(a),g=l(a);return"/"===a[a.length-1]?a+k(a.substr(0,a.length-1))+c:/^(\w+(?:s)?:\/\/|\.|file|\/)/.test(a)||-1!==f.indexOf(".")?"js"===g?a.substr(0,a.lastIndexOf("."))+c:a+c:a+"/"+f+c},n=function(b){var l,n,o,p=function(){var a=arguments,b=function(){var b,c=[];d(a,function(a){e(a)?c.push(p.System["import"](m(a))):"function"==typeof a&&(b=a)});var f=Promise.all(c);return b?f.then(function(a){return b&&b.apply(null,a)}):f};return"production"===p.config().env?b():l.then(b,b)};p.System=b,p.parseURI=i,p.joinURIs=j,p.normalize=m;var q=function(a){a.ext={};var b=a.normalize,c=/\.(\w+)!$/;a.normalize=function(d,e,f){var g,h=d.match(c);return h&&a.ext[g=h[1]]&&(d+=a.ext[g]),b.call(this,d,e,f)}};q(b);var r=function(a){var b=a.normalize;a.normalize=function(a,c,d){var e,f,g=a.length-1;return"/"===a[g]&&(e=a.substring(0,g).lastIndexOf("/"),f=a.substring(e+1,g),a+=f),b.call(this,a,c,d)}};r(b);var s={env:"development"};p.config=function(a){if(e(a)){var b=a;if(!(arguments.length>=2)){var c=u[b];return c&&c.get?c.get():s[b]}}else{if("object"!=typeof a){var g={};return d(u,function(a,b){a.get&&(g[b]=a.get())}),f(g,s)}a=f({},a),d(u,function(b,c){if(b.set&&a[c]){var d=b.set(a[c]);void 0!==d&&(s[c]=d),delete a[c]}}),f(s,a)}};var t=function(a){return{get:function(){return p.System[a]},set:function(b){p.System[a]="object"==typeof b&&"object"==typeof p.System[a]?f(p.System[a]||{},b||{}):b}}},u={env:{set:function(a){return v(),a}},baseUrl:t("baseURL"),root:t("baseURL"),config:{set:function(a){var c=k(a),d=g(a);b.paths.courierconfig=c,u.root.set((d===a?".":d)+"/")}},paths:t("paths"),map:t("map"),startId:{set:function(a){u.main.set(m(a))},get:function(){return b.main}},main:{get:t("main").get,set:function(a){b.main=a,v()}},meta:t("meta"),ext:t("ext")},v=function(){if("production"===s.env&&b.main){var a=b.main,c=b.bundlesPath||"bundles/",d=c+k(a);b.meta[d]={format:"amd"},b.bundles[d]=[a]}},w="less-1.7.0",x=function(){var a,e,f,g,i,j={},k=document.getElementsByTagName("script"),l=k[k.length-1];if(l){a=l.src.split("?"),e=a.shift(),f=a.join("?"),a=f.split(","),e.indexOf("courier.production")>-1&&(j.env="production"),g=a[0],g&&(j.startId=g),i=a[1],i&&(j.env=i),a=e.split("/");var m=a.pop();if(0!==m.indexOf("courier")||b.paths["courier/dev"]||(j.paths={"courier/*":a.join("/")+"/*.js",less:a.join("/")+"/"+w+".js","@traceur":a.slice(0,-1).join("/")+"/traceur/traceur.js"}),"courier"===h(a)&&(a.pop(),"bower_components"===h(a)&&a.pop()),d(l.attributes,function(a){var b=c(0===a.nodeName.indexOf("data-")?a.nodeName.replace("data-",""):a.nodeName);j[b]=a.value}),j.root||j.baseUrl||(j.root=a.join("/")+"/"),"production"===j.env){var n=j.paths=j.paths||{},o="bundles/*.css",p="bundles/*";n[o]||(n[o]="dist/bundles/*css"),n[p]||(n[p]="dist/bundles/*.js")}}return j},y=function(){var a={};return"string"!=typeof __dirname||b.paths["courier/dev"]||(a.paths={"courier/*":__dirname+"/*.js","@traceur":__dirname.split("/").slice(0,-1).join("/")+"/traceur/traceur.js"}),b.register("less",[],!1,function(){var a=require;return a("less")}),a};return p.startup=function(c){if(a.document)var g=x();else var g=y();f(b.ext,{css:"courier/css",less:"courier/less"}),p.config(g),c&&p.config(c);var h=p.config();d(h.executed||[],function(a,c){b.register(c,[],function(){})});var i=[];return h.startIds&&(i.push.apply(i,e(h.startIds)?[h.startIds]:h.startIds),h.startIds=i.slice(0)),"production"==h.env&&p.System.main?o=p.System.import(p.System.main)["catch"](function(a){}):"development"==h.env?(l=p.System.import("courierconfig"),n=l.then(function(){return c&&p.config(c),p.System.import("courier/dev")},function(a){return p.System.import("courier/dev")}),o=n.then(function(){return p.System.main?b.import(p.System.main):l}).then(function(){p.dev&&p.dev.log("app loaded successfully")},function(a){})):void 0},p};if("undefined"!=typeof System&&b(System),"undefined"!=typeof window){var o=window.courier;window.courier=n(System),window.courier.startup(o&&"object"==typeof o&&o),window.courier.addCourier=b}else require("systemjs"),a.courier=n(System),a.courier.System=System,a.courier.dev=require("./dev.js"),courier.clone=n,module.exports=a.courier,a.courier.addCourier=b}("undefined"==typeof window?global:window);